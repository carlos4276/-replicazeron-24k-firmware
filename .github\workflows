name: Build QMK firmware
on:
  push:
    branches: [ main, master ]
    paths:
      - '**.c'
      - '**.h'
      - '**.json'
      - '**.mk'
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout QMK
      uses: actions/checkout@v4
      with:
        repository: qmk/qmk_firmware
        submodules: recursive

    - name: Checkout keyboard files
      uses: actions/checkout@v4
      with:
        path: keyboards/replicazeron_24k

    - name: Install QMK CLI
      run: python3 -m pip install qmk

    - name: Setup QMK
      run: |
        qmk setup -y
        qmk config user.keyboard=replicazeron_24k
        qmk config user.keymap=default

    - name: Install build dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y gcc-arm-none-eabi binutils-arm-none-eabi

    - name: Build firmware
      run: qmk compile -kb replicazeron_24k -km default

    - name: Upload firmware
      uses: actions/upload-artifact@v4
      with:
        name: replicazeron_24k_firmware
        path: |
          .build/replicazeron_24k_default.bin
          .build/replicazeron_24k_default.hex
          .build/replicazeron_24k_default.elf
